version: '2'
services:
    # FRONTEND CONTAINER
    frontend:
        build: 
            context: ./app
            dockerfile: Dockerfile
            args:
            - CLIENTID=<CLIENT_ID>
            - CLIENTSECRET=<CLIENT_SECRET>
            - BACKENDURL=<BACKEND_URL>
        environment:
            - VIRTUAL_HOST=${VIRTUAL_HOST}
            - LETSENCRYPT_HOST=${LETSENCRYPT_HOST}
            - LETSENCRYPT_EMAIL=${LETSENCRYPT_EMAIL}
        env_file:
        - .env
        networks: 
        - front-easyrgpd.network

    # NGINX PROXY CONTAINER
    nginx-proxy:
        image: jwilder/nginx-proxy
        ports:
            #BACKEND port 343
            - "343:80"
            - "443:443"
        volumes:
            - "/srv/docker/nginx/certs:/etc/nginx/certs:ro"
            - "/etc/nginx/vhost.d"
            - "/usr/share/nginx/html"
            - "/var/run/docker.sock:/tmp/docker.sock:ro"
        networks: 
        - front-easyrgpd.network

    # LETS ENCRYPT CONTAINER
    nginx-proxy-companion:
        image: jrcs/letsencrypt-nginx-proxy-companion
        volumes:
            - "/srv/docker/nginx/certs:/etc/nginx/certs:rw"
            - "/var/run/docker.sock:/var/run/docker.sock"
        volumes_from:
            - nginx-proxy
        networks: 
        - front-easyrgpd.network

#CONTAINERS NETWORK
networks: 
  front-easyrgpd.network:
            
